<!DOCTYPE html>

<html>

<head>

    <title> CKart</title>

    <link rel="stylesheet" type="text/css" href="css/cart.css">

    <link rel="stylesheet" type="text/css"
        href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">

    <!-- Button -->
    <link href="//netdna.bootstrapcdn.com/bootstrap/3.1.0/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">
    <!-- <script src="//netdna.bootstrapcdn.com/bootstrap/3.1.0/js/bootstrap.min.js"></script> -->
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
</head>

<body>

    <!-- As a link -->
    <nav class=" navbar-light bg-light" style="background-color: #4843a3;height: 4em; color: white; padding-left: 42em;">
        <a href="/" style="    float: left;
        margin-left: -38em;
        margin-top: 1em;
        color: white;">Home</a>
        <a class="navbar-brand" href="#" style="font-size: x-large; font-weight: bold; color: white;">CKart</a>
    </nav>

    <!-- As a heading -->
    <!-- <nav class="navbar navbar-light bg-light">
    <span class="navbar-brand mb-0 h1">Navbar</span>
  </nav> -->

    <div class="container">

        <h1> Cart</h1>

        <div class="cart">

            <div class="products">
                    <% let total = 0 %>
                    <% let sum = 0 %>
                    <% for ( let i=0; i < cartItems.length; i++) { %>
                        <% total = total + (cartItems[i].product.Price*cartItems[i].quantity) %>
                        <% sum = sum + cartItems[i].quantity %>
                        <div class="product">

                            <img src="<%= cartItems[i].product.Image %>">

                            <div class="product-info">

                                <h3 class="product-name">
                                    <%= cartItems[i].product.Name %>
                                </h3>

                                <h4 class="product-price">$ <%= cartItems[i].product.Price %>
                                </h4>

                                <h4 class="product-offer">
                                    <%= cartItems[i].product.Description %>
                                </h4>


                                <p class="product-quantity">Qnt:

                                <div class="input-group" style="width: 110px;">
                                    <span class="input-group-btn">
                                        <button type="button" class="btn btn-danger btn-number" data-type="minus"
                                            data-field="quant[2]"
                                            onclick="changeQuantity('<%=cartItems[i]._id%>' , '<%=cartItems[i].product._id%>' , -1)">
                                            <span class="glyphicon glyphicon-minus"></span>
                                        </button>
                                    </span>
                                    <span type="text" name="quant[2]" class="form-control input-number" id="<%=cartItems[i].product._id%>" value="<%=cartItems[i].quantity%>"
                                        min="1" max="10" style="width: 42px;" ><%=cartItems[i].quantity%></span>
                                    <span class="input-group-btn">
                                        <button type="button" class="btn btn-success btn-number" data-type="plus"
                                            data-field="quant[2]"
                                            onclick="changeQuantity('<%=cartItems[i]._id%>' , '<%=cartItems[i].product._id%>' , 1)">
                                            <span class="glyphicon glyphicon-plus"></span>
                                        </button>
                                    </span>
                                </div>

                                <button class="product-remove" onclick="removeProcart('<%=cartItems[i]._id%>' , '<%=cartItems[i].product._id%>')">

                                    <i class="fa fa-trash" aria-hidden="true"></i>

                                    <span class="remove">Remove</span>

                                </button>

                            </div>

                        </div>

                        <% } %>

            </div>

            <div class="cart-total">

                <p>

                    <span>Total Price</span>

                    <span>$ <%=total%> </span>

                </p>

                <p>

                    <span>Number of Items</span>

                    <span><%=sum%></span>

                </p>

                <p>

                    <span>You Save</span>

                    <span>$ 0</span>

                </p>

                <a href="/place-order?total=<%=total%>">Proceed to Checkout</a>

            </div>

        </div>

    </div>
    

    <!-- complete: function(data) {
        alert('hi');
    } -->


</body>
<script>
    function changeQuantity(cartId,proId,count){
        let quantity = parseInt(document.getElementById(proId).innerHTML)
        count=parseInt(count)
        $.ajax({
            type:'POST',
            url:'/change-product-quantity',
            data:{
                cart:cartId,
                product:proId,
                count:count,
                quantity:quantity
            },
            dataType: 'json',
            success:(response)=>{

                if (response.removeProduct) {
                    alert("Product removed from cart")
                    location.reload()
                } else {
                    document.getElementById(proId).innerHTML = quantity + count
                }
                // let quant = $('#pro-quant').html()
                // quant = parseInt(quant)+count
                // $("#pro-quant").html(quant)
                // console.log(response)
                // alert(response)
            },
            error:(err)=>{
                alert(err)
            }
            
        })
    }

    function removeProcart(cartId,proId){
        
        $.ajax({
            type:'POST',
            url:'/remove-product-cart',
            data:{
                cart:cartId,
                product:proId
            },
            dataType:'json',
            success:(response)=>{
                alert("Product removed from cart")
                location.reload()
            }
        })
    }
</script>

</html>